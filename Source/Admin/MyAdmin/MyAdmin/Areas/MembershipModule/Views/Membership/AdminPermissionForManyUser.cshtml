@using MyAdmin.Helper
@model BusinessObject.MembershipModule.Enums.AdminUserModel
@{
    Layout = "~/Views/Shared/Metronic/_MainLayout.cshtml";
    ViewBag.Title = "Quản lý quyền";
}
<h3 class="page-title">
    Quản lý quyền
</h3>
<div class="outer" id="goldfree">
    <div class="inner bg-light lter">
        <div class="row">
            <div class="col-lg-12">
                <div class="box">
                    <div class="portlet box green">
                        <div class="portlet-title">
                            <div class="caption">
                                Thông tin
                            </div>
                        </div>
                        <div class="portlet-body">
                            <table class="table table-striped table-hover table-bordered display" id="oTable" cellspacing="0" style="width: 100%; height: 10px;">
                                <thead>
                                    <tr class="text-center">
                                        <th class="text-center" style="width: 50px">ID</th>
                                        <th>Tên trang</th>
                                        <th class="text-center" style="width: 120px">View</th>
                                        <th class="text-center" style="width: 120px">Edit-View</th>
                                        <th class="text-center" style="width: 120px">View-Delete</th>
                                        <th class="text-center" style="width: 120px">View-Edit-Delete</th>
                                    </tr>
                                </thead>
                                <tbody id="permission"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section styles
{
    <link href="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css")" rel="stylesheet" type="text/css" />
}

@section scripts{
    <script src="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/datatables/media/js/jquery.dataTables.min.js")" type="text/javascript"></script>
    <script src="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js")" type="text/javascript"></script>
    <script id="tmplPermission" type="text/x-jquery-tmpl">
        <tr>
            <td class='text-center'>${PageId}</td>
            <td class='text-left'><div style="padding-left: ${Level*30}px">${PageName}</div></td>
            <td class='text-center'>
                {{if FunctionPage >= 1}}
                <div>
                    <button onclick="OpenPermissionPopup('${PageId}', 1);" class='btn btn-success btn-xs'>Chọn</button>
                </div>
                {{/if}}
            </td>
            <td class='text-center'>
                {{if FunctionPage >= 2}}
                <div>
                    <button onclick="OpenPermissionPopup('${PageId}', 3);" class='btn btn-success btn-xs'>Chọn</button>
                </div>
                {{/if}}
            </td>
            <td class='text-center'>
                {{if FunctionPage >= 4}}
                <div>
                    <button onclick="OpenPermissionPopup('${PageId}', 5);" class='btn btn-success btn-xs'>Chọn</button>
                </div>
                {{/if}}
            </td>
            <td class='text-center'>
                {{if FunctionPage >= 4}}
                <div>
                    <button onclick="OpenPermissionPopup('${PageId}', 7);" class='btn btn-success btn-xs'>Chọn</button>
                </div>
                {{/if}}
            </td>
        </tr>
        {{if SubPages.length > 0}}
        {{tmpl(SubPages) "#tmplPermission"}}
        {{/if}}
    </script>
    <script type="text/javascript">
        var GetPermissions = function () {
            $.ajax({
                url: '@Url.Action("AdminGetPermissionForManyUser", "Membership")',
                type: "post",
                beforeSend: function () {
                    ShowLoading();
                },
                success: function (response) {
                    $('#permission').html($("#tmplPermission").tmpl(response));
                },
                error: function () {
                    showErrorToastr("Lỗi trong quá trình xử lý, xin thử lại sau.");
                },
                complete: function () {
                    HideLoading();
                }
            });
        };

        function OpenPermissionPopup(pageId, ruleId) {
            OpenPopup("Danh sách user", '@Url.Action("AdminUserForManyUser", "Membership")?PageID=' + pageId + '&Rules=' + ruleId + '', 800, false);
        }

        $(document).ready(function () {
            GetPermissions();

            $('#oTable').DataTable({
                scrollY: '500px',
                scrollCollapse: true,
                paging: false,
                searching: false,
                ordering: false
            });
        });

    </script>
}