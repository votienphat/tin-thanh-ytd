@using MyAdmin.Helper
@{
    Layout = "~/Views/Shared/Metronic/_MainLayout.cshtml";
    ViewBag.Title = "Quản lý nhóm Admin";
    ViewBag.PageName = "Quản lý nhóm Admin";
}
<style type="text/css">
    /* .slideThree */
    .slideThree {
        width: 80px;
        height: 26px;
        background: #333;
        margin: 0 auto;
        position: relative;
        border-radius: 50px;
        box-shadow: inset 0px 1px 1px rgba(0, 0, 0, 0.5), 0px 1px 0px rgba(255, 255, 255, 0.2);
    }

        .slideThree:after {
            content: 'OFF';
            color: #000;
            position: absolute;
            right: 10px;
            z-index: 0;
            font: 12px/26px Arial, sans-serif;
            font-weight: bold;
            text-shadow: 1px 1px 0px rgba(255, 255, 255, 0.15);
        }

        .slideThree:before {
            content: 'ON';
            color: #27ae60;
            position: absolute;
            left: 10px;
            z-index: 0;
            font: 12px/26px Arial, sans-serif;
            font-weight: bold;
        }

        .slideThree label {
            display: block;
            width: 34px;
            height: 20px;
            cursor: pointer;
            position: absolute;
            top: 3px;
            left: 3px;
            z-index: 1;
            background: #fcfff4;
            background: -webkit-linear-gradient(top, #fcfff4 0%, #dfe5d7 40%, #b3bead 100%);
            background: linear-gradient(to bottom, #fcfff4 0%, #dfe5d7 40%, #b3bead 100%);
            border-radius: 50px;
            -webkit-transition: all 0.4s ease;
            transition: all 0.4s ease;
            box-shadow: 0px 2px 5px 0px rgba(0, 0, 0, 0.3);
        }

        .slideThree input[type=checkbox] {
            visibility: hidden;
        }

            .slideThree input[type=checkbox]:checked + label {
                left: 43px;
            }

    /* end .slideThree */
</style>
<div class="outer">
    <div class="inner bg-light lter">
        <!--Begin Datatables-->
        <div class="row">
            <div class="col-lg-12">
                <div class="box">
                    <header>
                        <h5>
                            <span>Quản lý nhóm Admin</span>
                        </h5>
                    </header>
                    <div id="collapse4" class="body">
                        <div class="form-group">
                            <label for="txtGroupName" class="control-label col-lg-1">Nhóm Admin</label>
                            <div class="col-lg-5">
                                <input type="text" class="form-control" id="txtGroupName" placeholder="Nhập tên nhóm">
                            </div>
                            <button class="btn btn-primary col-lg-2" onclick="insertCauDoi();">Thêm nhóm</button>
                        </div>
                        <div class="clearfix"></div>
                        <br />
                        
                        <div class="portlet-body">
                            <table class="table table-striped table-hover table-bordered" id="myTable"></table>
                        </div>
                        
                        @*<table id="myTable" class="table table-bordered table-condensed table-hover table-striped">
                            <thead>
                                <tr class="text-center">
                                    <th class="text-left">STT</th>
                                    <th class="text-center">Tên Nhóm</th>
                                    <th class="text-center">Trạng Thái</th>
                                    <th class="text-center">CreateDated</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>*@
                    </div>
                </div>
            </div>
        </div>
        <!-- /.row -->
    </div>
    <!-- /.inner -->
</div>
<!-- /.outer -->
<script type="text/javascript">
    var oTable;
    function insertCauDoi() {
        if ($("#txtGroupName").val().trim() == "") {
            showErrorToastr("tên nhóm không hợp lệ.");
            $("#txtGroupName").focus();
        } else {
            $.ajax({
                url: '@Url.Action("InsertGroupAdmin", "Membership")',
                type: "post",
                data: { "GroupName": $("#txtGroupName").val().trim() },
                dataType: 'json',
                beforeSend: function () {
                    ShowLoading();
                },
                success: function (data) {
                    if (data != null) {
                        if (data.Success) {
                            showSuccessToastr(data.Message);
                            $("#txtGroupName").val("");
                            oTable.fnSort([[3, 'desc']]);
                        } else {
                            showErrorToastr(data.Message);
                        }
                    } else {
                        showErrorToastr("Lỗi trong quá trình xử lý, xin thử lại sau.");
                    }

                },
                error: function () {
                    showErrorToastr("Lỗi đường truyền, xin thử lại sau.");
                },
                complete: function () {
                    HideLoading();
                }
            });
        }
    };
    $(document).ready(function () {
      ///  oTable = function () {
            $.ajax({
                url: '@Url.Action("GetGroupAdminManager", "Membership")',
                //data: $("#txtSearchUser").val(),
                contentType: "application/json;charset=uft-8",
                dataType: 'JSON',
                async: false,
                error: function (res) {
                    alert(res);
                },
                success: function (data) {
                    if (data.length == 0) {
                    } else {

                        if ($.fn.dataTable.isDataTable(oTable)) {
                            oTable.dataTable().fnDestroy();
                        }

                        oTable = $('#myTable').dataTable({
                            "lengthMenu": DataTablesConst.LengthMenu,
                            "pageLength": DataTablesConst.PageLength,
                            "language": DataTablesConst.Language,
                            //"data": data,
                            "columns": [
                               {
                                   "data": "ID",
                                   "title": "ID"
                               }, {
                                   "data": "GroupName",
                                   "title": "Tên nhóm"
                               }, {
                                   "data": "Status",
                                   "title": "Trạng thái"
                               }, {
                                   "data": "DateCreated",
                                   "title": "Ngày tạo"
                               }
                            ],
                            "order": [
                                [0, "asc"]
                            ] // set first column as a default sort by asc
                        });
                    }
                },
                type: 'POST'
            });
       // }

        $('#myTable tbody').on('change', '.slideThree input[type=checkbox]', function () {
            var thisElement = $(this);
            $.ajax({
                url: '@Url.Action("UpdateStatusGroupAdmin", "Membership")',
                type: "post",
                data: { "GroupId": $(this).val(), "Status": $(this).is(":checked") },
                dataType: 'json',
                beforeSend: function () {
                    ShowLoading();
                },
                success: function (data) {
                    if (data != null) {
                        if (data.Success) {
                            showSuccessToastr(data.Message);
                        } else {
                            showErrorToastr(data.Message);
                            if (thisElement.is(":checked")) {
                                thisElement.removeAttr("checked");
                            } else {
                                thisElement.attr("checked", "checked");
                            }
                        }
                    } else {
                        showErrorToastr("Lỗi trong quá trình xử lý, xin thử lại sau.");
                    }

                },
                error: function () {
                    showErrorToastr("Lỗi đường truyền, xin thử lại sau.");
                },
                complete: function () {
                    HideLoading();
                }
            });
        });

        /*oTable = $('#myTable')
            .on('preXhr.dt', function () {
                ShowLoading();
            })
            .on('xhr.dt', function () {
                HideLoading();
            })
            .dataTable({
                "jQueryUI": true,
                "scrollY": false,
                "scrollCollapse": true,
                "bFilter": false,
                "bSort": false,
                "scrollX": false,
                //"bProcessing": true,
                "bServerSide": true,
                "sAjaxSource": 'Url.Action("GetGroupAdminManager", "Membership")',
                "sServerMethod": "POST",
                //"fnServerParams": function (aoData) {

                //},
                "columns": [
                    { "data": "ID", "sClass": "align-left", "sType": "numeric", "bSortable": false }, //0
                    { "data": "GroupName", "sClass": "align-left" }, //1
                    { "data": "Status", "sClass": "align-right" },//2
                    { "data": "DateCreated", "sClass": "align-left" } //3
                ],
                "order": [[3, "desc"]],
                "lengthMenu": [[20, 40, 60, 100], [20, 40, 60, 100]],
            });
        $('#myTable tbody').on('change', '.slideThree input[type=checkbox]', function () {
            var thisElement = $(this);
            $.ajax({
                url: 'Url.Action("UpdateStatusGroupAdmin", "Membership")',
                type: "post",
                data: { "GroupId": $(this).val(), "Status": $(this).is(":checked") },
                dataType: 'json',
                beforeSend: function () {
                    ShowLoading();
                },
                success: function (data) {
                    if (data != null) {
                        if (data.Success) {
                            showSuccessToastr(data.Message);
                        } else {
                            showErrorToastr(data.Message);
                            if (thisElement.is(":checked")) {
                                thisElement.removeAttr("checked");
                            } else {
                                thisElement.attr("checked", "checked");
                            }
                        }
                    } else {
                        showErrorToastr("Lỗi trong quá trình xử lý, xin thử lại sau.");
                    }

                },
                error: function () {
                    showErrorToastr("Lỗi đường truyền, xin thử lại sau.");
                },
                complete: function () {
                    HideLoading();
                }
            });
        });*/
        $('#myTable tbody').on('click', 'a.groupName', function () {
            var clickevent = arguments.callee;
            var oldValue = $(this).text().trim();
            var relId = $(this).attr("rel");
            var input = $("<input>", {
                val: $(this).text().trim(),
                type: "text"
                , rel: relId
            });
            $(this).replaceWith(input);
            input.select();
            input.bind("blur", function () {
                var newValue = $(this).val().trim();
                if (newValue.length <= 0 || newValue == oldValue) {
                    newValue = oldValue;
                    var aText = $("<a class='groupName' href='javascript:void(0)'>").attr("rel", relId).text(newValue);
                    input.replaceWith(aText);
                    aText.bind("click", clickevent);
                } else {
                    $.ajax({
                        url: '@Url.Action("EditGroupAdmin", "Membership")',
                        type: "post",
                        data: { "GroupId": input.attr("rel"), "GroupName": newValue },
                        dataType: 'json',
                        beforeSend: function () {
                            ShowLoading();
                        },
                        success: function (data) {
                            if (data != null) {
                                if (data.Success) {
                                    showSuccessToastr(data.Message);

                                } else {
                                    showErrorToastr(data.Message);
                                    newValue = oldValue;
                                }
                            } else {
                                showErrorToastr("Lỗi trong quá trình xử lý, xin thử lại sau.");
                                newValue = oldValue;
                            }

                        },
                        error: function () {
                            showErrorToastr("Lỗi đường truyền, xin thử lại sau.");
                        },
                        complete: function () {
                            HideLoading();
                            aText = $("<a class='groupName' href='javascript:void(0)'>").attr("rel", relId).text(newValue);
                            input.replaceWith(aText);
                            aText.bind("click", clickevent);
                        }
                    });
                }

            });
        });



    });
</script>
