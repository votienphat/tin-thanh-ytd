@using MyAdmin.Helper
@using MyUtility

@{
    ViewBag.Title = "Lịch sử khóa tài khoản";
    Layout = "~/Views/Shared/Metronic/_MainLayout.cshtml";
    var curDate = DateTime.Now;
    var beginDateTemp = curDate.AddDays(-7);
    var endDate = new DateTime(curDate.Year, curDate.Month, curDate.Day, 23, 59, 59);
    var beginDate = new DateTime(beginDateTemp.Year, beginDateTemp.Month, beginDateTemp.Day, 0, 0, 0);
}


<div class="portlet box blue">
    <div class="portlet-title">
        <div class="caption">
            <i class="fa fa-tachometer"></i>Điều Kiện Lọc
        </div>

    </div>
    <div class="portlet-body" style="display: block;overflow: hidden;">
        <div class="form-group col-sm-3">
            <label class="">Từ khóa</label>
            <div class="input-icon input-group  col-sm-12">
                <i class="fa fa-child"></i>
                <input type="text" class="form-control" id="txtKeyword" placeholder="Nhập User ID/ tên hiển thị">
            </div>
        </div>
       
        <div class="col-lg-5 col-xs-12">
            <label class="">Thời gian</label>
            <div class="input-daterange input-group" id="dayPicker">
                <input type="text" id="dayPickerStart" class="input-sm form-control" name="start"
                       value="@DateTime.Now.FirstDayOfMonth().GetBeginOfDay().GetVnDateTimeFormat()" />
                <span class="input-group-addon">đến</span>
                <input type="text" id="dayPickerEnd" class="input-sm form-control" name="end"
                       value="@DateTime.Now.GetEndOfDay().GetVnDateTimeFormat()" />
            </div>
        </div>
        <div class="form-group col-sm-1">
            <label class="" style="height: 15px;"></label>
            <div class="input-icon input-group  col-sm-12">
                <button type="button" id="btnSearch" class="btn btn-success">Tìm <i class="fa fa-search"></i></button>
            </div>
        </div>
    </div>
</div>
<div class="portlet box green-haze">
    <div class="portlet-title">
        <div class="caption">
            <i class="fa fa-globe"></i>Lịch sử khóa tài khoản
        </div>
        <div class="tools">
            <a href="javascript:;" class="collapse">
            </a>
            <a href="#portlet-config" data-toggle="modal" class="config">
            </a>
            <a href="javascript:;" class="reload">
            </a>
            <a href="javascript:;" class="remove">
            </a>
        </div>
    </div>
    <div class="portlet-body">
            <table class="table table-striped table-bordered" id="myTable"></table>
    </div>
</div>
@section styles{
    <link href="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.css")" rel="stylesheet" type="text/css" />
}
@section scripts{
    @*<script src="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/datatables/media/js/jquery.dataTables.min.js")" type="text/javascript"></script>
    <script src="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js")" type="text/javascript"></script>
    <script src="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/bootstrap-daterangepicker/moment.min.js")" type="text/javascript"></script>
    <script src="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.js")" type="text/javascript"></script>
    <script src="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js")" type="text/javascript"></script>*@



<script src="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js")" type="text/javascript"></script>
<script src="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/bootstrap-daterangepicker/moment.min.js")" type="text/javascript"></script>
<script src="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/bootstrap-daterangepicker/daterangepicker.js")" type="text/javascript"></script>
<script src="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/datatables/media/js/jquery.dataTables.min.js")" type="text/javascript"></script>
<script src="@Url.ContentVersion("~/Content/Metronic/assets/global/plugins/datatables/plugins/bootstrap/dataTables.bootstrap.js")" type="text/javascript"></script>
    <script type="text/javascript">
        var oTable;
        var oTableId = '#myTable';    
        ParseQueryString(oTable);

        var search = function () {
            if ($.fn.dataTable.isDataTable(oTableId)) {
                oTable.destroy();
            }

            oTable = $(oTableId).DataTable({
                "serverSide": true,
                "processing": true,
                "filter": false,
                "lengthMenu": DataTablesConst.LengthMenu,
                "pageLength": DataTablesConst.PageLength,
                "language": DataTablesConst.Language,
                "ajax": {
                    "url": '@Url.Action("GetUserLockedLogData", "Membership")',
                    'data': function (d) {
                        d.keyword = $('#txtKeyword').val();
                        d.fromDateTime = $('#dayPickerStart').val();
                        d.toDateTime = $('#dayPickerEnd').val();// $("#txtDateBegin").val();

                    },
                    "type": "POST",
                    "dataSrc": function (json) {
                        if (!checkRight(json)) {
                            json = { iTotalRecords: 0, iTotalDisplayRecords: 0, sEcho: 1, aaData: [] };
                        }
                        if (json.aaData == null) {
                            json.aaData = [];
                        } else {
                            $(json.aaData).each(function (index, item) {
                                item.dateIn = item.TimeIn;
                                item.dateOut = item.TimeOut;
                                item.dateIn = moment(item.dateIn).format(DateTimeFormat.UpperDateTime);
                                item.dateOut = moment(item.dateOut).format(DateTimeFormat.UpperDateTime);
                            });
                        }

                        return json.aaData;
                    }
                },
                "drawCallback": function () {
                    $.each($('.make-switch'), function () {
                        $(this).bootstrapSwitch({
                            onText: $(this).data('onText'),
                            offText: $(this).data('offText'),
                            onColor: $(this).data('onColor'),
                            offColor: $(this).data('offColor'),
                            size: $(this).data('size'),
                            labelText: $(this).data('labelText')
                        });
                    });
                },
                "columns": [
                       {
                           "data": "Username",
                           "title": "Tài khoản bị khóa",
                           "className": "align-center",
                           "width": "150px",
                           "orderable": false
                       }, {
                           "data": "UserId",
                           "title": "UserID bị khóa ",
                           "className": "align-center",
                           "width": "50px",
                           "orderable": false
                       },
                       {
                           "data": "BlackListType",
                           "title": "Khóa / Mở khóa",
                           "className": "align-center",
                           "width": "50px",
                           "orderable": false,
                           "render": function (data) {
                               if (data == 1) {
                                   return "Khóa";
                               } else {
                                   return "Chưa xác định";
                               }
                           }
                       },
                       {
                           "data": "UsernameAdmin",
                           "title": "Admin thực hiện",
                           "className": "align-center",
                           "width": "50px",
                           "orderable": false
                       }
                       ,
                       {
                           "mData": "DateStart",
                           "title": "Thời gian bắt đầu khóa",
                           "className": "align-left",
                           "render": function (data, type, full) {
                               return moment(data).format(DateTimeFormat.UpperDateTime);
                           }
                       },
                       {
                           "mData": "DateEnd",
                           "title": "Thời gian kết thúc khóa",
                           "className": "align-left",
                           "render": function (data, type, full) {
                               return moment(full['DateEnd']).format(DateTimeFormat.UpperDateTime);
                           }
                       }
                       ,
                       //{
                       //    "data": "DateEnd",
                       //    "title": "Ngày kết thúc",
                       //    "className": "align-left",
                       //    "render": function (data) {
                       //        return moment(data).format(DateTimeFormat.UpperDateTime);
                       //    }
                       //},
                       {
                           "data": "DateCreate",
                           "title": "Ngày thực hiện",
                           "className": "align-left",
                           "render": function (data) {
                               return moment(data).format(DateTimeFormat.UpperDateTime);
                           }
                       },
                       {
                           "data": "Reason",
                           "title": "Lý Do",
                           "className": "align-center",
                           "width": "50px",
                           "orderable": false
                       }
                ],
                "ordering": false
            });
        };

    $(function () {
        $('#dayPickerStart').datetimepicker({
            format: DateTimeFormat.LowerTimeFull,
            lang: 'vi',
            timepicker: true,
            autoclose: true,
        });
        $('#dayPickerEnd').datetimepicker({
            format: DateTimeFormat.LowerTimeFull,
            lang: 'vi',
            timepicker: true,
            autoclose: true,
        });
        //$('#dayPickerStart, #dayPickerEnd').datepicker({
        //    //format: DateTimeFormat.LowerDate,
        //    //defaultDate: moment().format(),
        //    format: DateTimeFormat.LowerDateTime,
        //    isRTL: Metronic.isRTL(),
        //    //startDate: "2014-01-27 10:00:00",
        //    timepicker: true,
        //    autoclose: true,
        //    minuteStep: 10
        //});
        $(document).ready(function () {
            $("#btnSearch").click(function () {
                search();
            });
          
        });
    });


    </script>
}
